 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <style>
    .slimScrollDiv {
        width: 100% !important;
    }
 </style>
@using WebApp.Extensions
@{
    var httpContext = ViewContext.HttpContext;
    string appDomain = $"{httpContext.Request.Scheme}://{httpContext.Request.Host}";
}
<div class="navbar-custom navbar-wrap">
    <ul class="list-unstyled topnav-menu float-right mb-0">

        <li class="d-none d-sm-block">
            <form class="app-search">
                <div class="app-search-box">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search...">
                        <div class="input-group-append">
                            <button class="btn" type="submit">
                                <i class="fe-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </li>

        <li class="dropdown notification-list">
            <a class="nav-link dropdown-toggle  waves-effect waves-light" data-toggle="dropdown" href="#" role="button"
                aria-haspopup="false" aria-expanded="false">
                <i class="fe-bell noti-icon"></i>
          <span id="notificationBadge" class="badge badge-danger rounded-circle noti-icon-badge">0</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right dropdown-lg">

                <!-- item-->
                <div class="dropdown-item noti-title">
                    <h5 class="m-0">
                        <span class="float-right">
                               <button id="clearAllButton" class="btn btn-secondary">Clear All</button>
                        </span>Notification
                    </h5>
                </div>
                @* <div class="dropdown-menu dropdown-menu-right" id="notificationDropdown">
                    <!-- Notifications will be dynamically inserted here -->
                </div> *@

                <div class="slimscroll noti-scroll" id="notificationDropdown" style="width: 100% !important;">

                    @* <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item notify-item active">
                        <div class="notify-icon bg-soft-primary text-primary">
                            <i class="mdi mdi-comment-account-outline"></i>
                        </div>
                        <p class="notify-details">
                            Doug Dukes commented on Admin Dashboard
                            <small class="text-muted">1 min ago</small>
                        </p>
                    </a>

                    <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                        <div class="notify-icon">
                            <img src="~/assets/admin/images/users/avatar-2.jpg" class="img-fluid rounded-circle" alt="">
                        </div>
                        <p class="notify-details">Mario Drummond</p>
                        <p class="text-muted mb-0 user-msg">
                            <small>Hi, How are you? What about our next meeting</small>
                        </p>
                    </a>


                    <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                        <div class="notify-icon bg-info">
                            <i class="mdi mdi-comment-account-outline"></i>
                        </div>
                        <p class="notify-details">
                            Caleb Flakelar commented on Admin
                            <small class="text-muted">4 days ago</small>
                        </p>
                    </a>

                    <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                        <div class="notify-icon bg-secondary">
                            <i class="mdi mdi-heart"></i>
                        </div>
                        <p class="notify-details">
                            Carlos Crouch liked
                            <b>Admin</b>
                            <small class="text-muted">13 days ago</small>
                        </p>
                    </a> *@
                </div>

                <!-- All-->
                <a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
                    View all
                    <i class="fi-arrow-right"></i>
                </a>

            </div>
        </li>

        <li class="dropdown notification-list">
            <a class="nav-link dropdown-toggle nav-user mr-0 waves-effect waves-light" data-toggle="dropdown" href="#"
                role="button" aria-haspopup="false" aria-expanded="false">
                @if (!string.IsNullOrEmpty(User.GetSpecificClaim("Avatar")))
                {
                    <img src="@appDomain@User.GetSpecificClaim("Avatar")" alt="user-image" class="rounded-circle">
                }
                else
                {
                    <img src="~/assets/images/user.png" alt="user-image" class="rounded-circle">
                }
                <span class="pro-user-name ml-1">
                    @User.GetSpecificClaim("FullName") <i class="mdi mdi-chevron-down"></i>
                </span>
            </a>
            <div class="dropdown-menu dropdown-menu-right profile-dropdown ">
                <!-- item-->
                <a href="/home" class="dropdown-item notify-item">
                    <i class="fe-home"></i>
                    <span>Web Hotel</span>
                </a>
                <div class="dropdown-divider"></div>

                <!-- item-->
                <a href="/Admin/Account?UserId=@User.GetSpecificClaim("UserId")" class="dropdown-item notify-item">
                    <i class="remixicon-account-circle-line"></i>
                    <span>Tài khoản của tôi</span>
                </a>
                <div class="dropdown-divider"></div>

                <!-- item-->
                <a href="javascript:void(0);" onclick="logout();" class="dropdown-item notify-item">
                    <i class="remixicon-logout-box-line"></i>
                    <span>Đăng xuất</span>
                </a>
            </div>
        </li>
    </ul>

    <!-- LOGO -->
    <div class="logo-box">
        <a href="Dashboard" class="logo text-center">
            <span class="logo-lg">
                <img src="~/assets/landing-page/image/Logo.png" />
                <!-- <span class="logo-lg-text-light">Xeria</span> -->
            </span>
            <span class="logo-sm">
                <!-- <span class="logo-sm-text-dark">X</span> -->
                <img src="~/assets/landing-page/image/Logo.png" alt="" height="24">
            </span>
        </a>
    </div>

    <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
        <li>
            <button class="button-menu-mobile waves-light">
                <i class="fe-menu"></i>
            </button>
        </li>
    </ul>
</div>
<script>
      function clearNotifications() {
            $('#notificationDropdown').html('');
             $('#notificationBadge').text('0');
        }

    function logout() {
        $.ajax({
            type: "POST",
            url: "/Admin/Login/Logout",
            success: function () {
                window.location.href = "/Admin/Login";
            }
        });
    }

    function loadNotifications() {
        $.ajax({
            type: "GET",
            url: "/Admin/Booking/Notification",
            dataType: "json",
            success: function (response) {
                var notificationHtml = '';
                var orderCount = response; // The response should be the count of new bookings

                if (orderCount > 0) {
                    notificationHtml = `
                        <a href="javascript:void(0);" class="dropdown-item notify-item active">
                        <div class="notify-icon bg-soft-primary text-primary">
                            <i class="mdi mdi-comment-account-outline"></i>
                        </div>
                        <p class="notify-details">
                            Have ${orderCount} orders that need confirmation today
                        </p>
                    </a>
                    `;
                } else {
                    notificationHtml = '<p>No pending orders</p>';
                }

                $('#notificationDropdown').html(notificationHtml);
                  $('#notificationBadge').text(orderCount);
            },
            error: function () {
                $('#notificationDropdown').html('<p>Error loading notifications</p>');
            }
        });
    }

    // Call the function to load notifications on page load
    $(document).ready(function() {
        loadNotifications();

        // Optionally, refresh notifications periodically (e.g., every 30 seconds)
        setInterval(loadNotifications, 30000);
           $('#clearAllButton').click(function() {
                clearNotifications();
            });
    });
</script>
